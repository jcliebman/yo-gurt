def GAME_END(x, y):
    if Map[y][x] == FINISH:
        print("You Win!!!")
        turtle.bye()

def draw_square(size, color):
    t.fillcolor(color)
    t.begin_fill()
    for fill in range(4):
        t.forward(size)
        t.right(90)
    t.end_fill()

def get_color(element):
    if element == PATH:
        return ""
    elif element == WALL:
        return "black"
    elif element == RIVER:
        return "blue"
    elif element == MATERIALS:
        return "brown"
    elif element == KEYS:
        return "yellow"
    elif element == DOORS:
        return "orange"
    elif element == FINISH:
        return "green"
    

def draw_map(map_data, x_start, y_start, box_size):
    screen.tracer(0)
    t.penup()
    t.goto(x_start, y_start)
    t.pendown()
    
    for row in map_data:
        for element in row:
            color = get_color(element)
            draw_square(box_size, color)
            t.penup()
            t.forward(box_size)
            t.pendown()
        t.penup()
        t.goto(x_start, t.ycor() - box_size)
        t.pendown()
    screen.update()
    screen.tracer(1)


#Function to grab, and erase items from the map
def item_grab(x, y):
    global Mats, Keys, Map, BM_count
    if Map[y][x] == MATERIALS and BM_count <= 2:
        decision = turtle.textinput("!?!?!?!", "You found building materials! Wanna pick 'em up 'y'/'n'")
        if decision == "y":
            Mats= Mats + 1
            print("You picked up the building materials!")
            print("You currently have", Mats, "building materials")
            print(" ")
            Map[y][x] = 0
            BM_count=BM_count+1
            t.clear()
            draw_map(Map, x_start, y_start, box_size)
            listen()
        elif Map[y][x] == MATERIALS and decision != "y":
            print("You decided not to pick up the building materials.")
            print("You currently have", Mats, "building materials.")
            print(" ")
            listen()
        
    elif Map[y][x] == MATERIALS and BM_count==3:
        decision1 = turtle.textinput("More mats 😐", "PICK THEM UP!?!?!?! 'y'/'n'")
        if decision1 == "y":
            Mats= Mats + 1
            print("You picked up the building materials!")
            print("You currently have", Mats, "building materials")
            print(" ")
            Map[y][x] = 0
            BM_count=BM_count+1
            t.clear()
            draw_map(Map, x_start, y_start, box_size)
            listen()
        elif Map[y][x] == MATERIALS and decision != "y":
            print("You decided not to pick up the building materials.")
            print("You currently have", Mats, "building materials.")
            print(" ")
            listen()
        
    elif Map[y][x] == MATERIALS and BM_count>=4:
        BM_count=0
        decision2 = turtle.textinput("For Real?", "Pick that shit up? 'y'/'n'")
        if decision2 == "y":
            Mats= Mats + 1
            print("You picked up the building materials!")
            print("You currently have", Mats, "building materials")
            print(" ")
            Map[y][x] = 0
            BM_count=BM_count+1
            t.clear()
            draw_map(Map, x_start, y_start, box_size)
            listen()
        elif Map[y][x] == MATERIALS and decision != "y":
            print("You decided not to pick up the building materials.")
            print("You currently have", Mats, "building materials.")
            print(" ")
            listen()
            
# Forever just let the player move around the map on the path
while True:
    moveDir = input("Enter direction (u,d,l,r): ")
    currX, currY = movePlayer(currX, currY, moveDir)
    item_grab(currX, currY)
    drawMap(currX, currY)
    GAME_END(currX, currY)
